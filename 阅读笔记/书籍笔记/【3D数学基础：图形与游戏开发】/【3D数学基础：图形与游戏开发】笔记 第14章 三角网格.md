[TOC]

# 【3D数学基础：图形与游戏开发】笔记 第14章 三角网格

# 网格

网格就是由很多个三角形或者多边形构成的，在图形学和建模中广泛应用，用来模拟复杂物体的表面。三角形网格：

![image-20210906102600627](https://sin998-blog-image.oss-cn-beijing.aliyuncs.com/images/202109061026555.png)

四边形网格：

![image-20210906103027902](https://sin998-blog-image.oss-cn-beijing.aliyuncs.com/images/202109061030522.png)

本章主要讨论三角网格。**当然,任意多边形网格都能转换成三角网格。**我们讨论的大多数概念对多边形和三角网格都适用。**三角网格以其简单性而吸引人,相对于一般多边形网格,许多操作对三角网格更容易。**当然,多边形在某些情况下具有优势,在差别很显著的时候我们会作出解释。

# 表示网格

![image-20210906103534804](https://sin998-blog-image.oss-cn-beijing.aliyuncs.com/images/202109061035185.png)

对于某些应用程序,这种表示方法已经足够。然而,术语“网格”隐含的相邻三角形的联通性却在种简单表示中有任何体现。实际应用中出现的三角网格,每个二角形都和其他三角形共享边。于是三角网格需要存储三类信息:

- 顶点。每个三角形都有三个顶点。各顶点都有可能和其他三角形共享。
- 边。连接两个顶点的边。每个三角形有三条边。
- 面。每个三角形对应一个面。我们可以用顶点或边列表表示面。

根据应用程序的不同,有多种有效的网格表示方法,本章集中讨论一种标准存储格式:索引三角网格。

## 索引三角网格

在索引三角网格中,我们维护了两个列表:顶点表与三角形表。

每个顶点包含一个3D位置,也可能有如纹理映射坐标、表面法向量、光照值等附加数据。

通常,顶点列出的顺序是非常重要的,因为我们必须考虑“正面”和“反面”。从前面看时,我们将用顺时针方向列出项点。另外些信息也存在这一级中,如预先计算的表面法向量,表面属性(纹理映射)等。

![image-20210907110218992](https://sin998-blog-image.oss-cn-beijing.aliyuncs.com/images/202109071102944.png)

![image-20210907110155316](https://sin998-blog-image.oss-cn-beijing.aliyuncs.com/images/202109071101402.png)

注意到,索引三角形列表中的邻接信息是隐含的,例如:边信息没有直接存储,但我们还是可以通过搜索三角形表找出公共边。和前面“三角形数组”方式相比,这种方式确实能节省不少空间。原因是信息存于顶点级别,它的整数索引比之三角形数组里存储的顶点重复率要小得多。实践中,三角网里确实有大量的联通性问题。

## 高级技术

简单索引三角网格对于基本应用够了。但为吏加高效地实现某些操作还可以进行一些改进。主要的问题是邻接信息没有显式表达,所以必须从三角形列表中搜索。另一种表达方法可以在常数时间内取得这种信息。
方法是显式维护一个边列表,每边出两个端点定义,同吋维护一个共享该边的三角形列表。这样，三角形可视为三条边而非三个点的列表,也就是说它是边列表而不是点列表的索引。该思想的一个扩展称作“ winged edge”模型,对每一顶点,存储使用该点的边的索引。这样,三角形和边都可以通过定位点列表快迷査找,请见参考资料[8]和[9]。

## 针对渲染的特殊表达

大多数图形卡并不直接支持索引三角网。渲染三角形时,一般是将三个顶点同时提交。这样,共享顶点会多次提交,三角形用到一次就提交一次。因为内存和图形硬件间的数据传输是瓶颈,所以许多API硬件支持特殊的三角网格式以减少传输量。基本思想是排序点和面,使得显存中已有的三角形不需要再次传输。

从最高灵活性到最低灵活性,我们讨论三种方案：

- 顶点、索引缓存。它们存储在显卡的显存中，显存的速度极快，而普通的显示技术都是内存保存，速度稍慢。
- 三角带
- 三角扇

### 顶点缓存

说顶点缓存是一种特殊的存储格式,不如说是API和硬件之间的一种存储策略,用以发挥相续三角形顶点一致性的特点。通常,高级代码不需要了解顶点缓存是如何实现和执行的;后面我们会给出一些骤以最大限度地利用顶点缓存。

和其他缓存机制类似,顶点缓存基于最近使用的数据未来仍将被使用的原则。图形处理器缓存一小分(如,16个)最近使用的顶点,当AP要发送顶点时,首先探测级存内是否已存在。当然,这要求API了解图形卡缓存的大小和替换机制。若缓存内没有该顶点,则发生脱靶,AP发送顶点,并更新缓存;若缓存内有该顶点,就命中,API通知图形卡“使用缓存内位置x的顶点“。

如前所述,顶点缓存其实是种底层的优化手段。任何三角网都可用高级代码实现止确渲染而不用考虑缓存。但进行顶点顺序的调整,使共享顶点的三角形集中发送有助于提高效率。这种调整只需要进行一次,并且可以离线进行。它只会对性能有帮助,不会使没有缓存的系统性能降低。参考附录B中的参考资料[14]以获得更多信息。

善用缓存,可能使发送到显卡的顶点数降低到平均每三角形少于一个。

### 三角带



### 三角扇







# 参考资料&原文链接

[Bilibili_猎豹网校：游戏开发之3D数学基础](https://www.bilibili.com/video/BV1ib411K7TK)

# 本文标签

`游戏开发`、`3D数学基础：图形与游戏开发`、`Unreal Engine`、`游戏开发基础`、`数学`、`游戏开发数学基础`、`书籍笔记`。

