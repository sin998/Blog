[TOC]

# 【UE4】加载资源的方式（九）各种加载方式特点总结和选择

# 参考文章&参考资料&原文链接

[UE4中资源的引用](https://www.cnblogs.com/kekec/p/13357937.html)

[UE4的资源管理](https://zhuanlan.zhihu.com/p/357904199)

前面几篇文章介绍了各种各样资源的加载方式，现在就来对它们进行一个总结。以后就当工具查了，忘了就回来看一眼。

# 引用

分为软性引用、硬性引用、构造时引用、强引用和弱引用。

## 基本方式

在`UE4 4.18`版本之前：

`FStringAssetReference`、`FStringClassReference`、`FAssetPtr`、`TAssetPtr`、`TAssetSubclassOf`。

`UE4. 4.18`版本之后：

`FSoftObjectPath`、`FSoftClassPath`、`FSoftObjectPtr`、`TSoftObjectPtr`、`TSoftClassPtr `。

推荐使用最新的引用方式。

## 特点

- 对美术师或设计师来说十分友好，他们可以在蓝图中直接使用，可以直接实时预览效果。
- 可以考虑使用`DataAsset`来存储引用，统一管理。

## 注意

- 需要熟悉它们定义和区别，以及它们之间的联系和区别，例如4.18之前是用的哪几个，在4.18及之后又改成了什么。

- 硬性引用资产过大时要注意性能问题。可以考虑用弱引用，然后再在合适的地方异步加载。

- 有些引用有模板类，十分方便。例如：`TSoftObjectPtr`、`TSubclassOf`。

- 对于`FSoftObjectPath`来说：可以使用`UPROPERTY(meta=(AllowedClasses="Material,StaticMesh"))`来筛选原生的UE4特定的类型。

- 对于`FSoftClassPath`来说：要筛选我们自定义继承`UObject`的类型可以使用`UPROPERTY(meta = (MetaClass = "MyActor"))`来筛选。

- 在使用之前用`IsPending`或`IsValid`检查是否设置了引用以及引用的资源是否已经准备好是一个好习惯。

- 如果引用是以字符串的形式直接写在代码里面的话，例如：

  ```c++
   static ConstructorHelpers::FClassFinder<APawn> PlayerPawnBPClass(TEXT("/Game/ThirdPersonCPP/Blueprints/ThirdPersonCharacter"));
  ```

  那么在构建版本时，并不会将该引用cook进包中，这是个巨坑，可以考虑使用`DataAsset`来统一处理。

  如果没有用`DataAsset`的话那么就需要手动指定，让该资源打进包中。在`DefaultGame.ini`的文件的`/Script/UnrealEd.ProjectPackagingSettings`标签的`DirectoriesToAlwaysCook`数组中配置包含该资源的目录。例如：

  ```c++
  [/Script/UnrealEd.ProjectPackagingSettings]
  +DirectoriesToAlwaysCook=(Path="/Game/ThirdPersonCPP/Blueprints")
  ```

  与指定字符串路径相比，当在编辑器中对被软引用到的资源进行移动、改名等操作时，ue4会进行自动调整。

- 强引用是自动加载资源的，弱引用可能已经加载了可能没加载，如果没加载的话需要我们手动加载。强引用和弱引用的区别：

  ```c++
  UCLASS(config=Game)
  class AMyTest1Character : public ACharacter
  {
      GENERATED_BODY()
      
      // ... ...
      
  public:
      UPROPERTY(Category = MyTest1, EditAnywhere) TSoftObjectPtr<UTexture2D> SourceTexture1; // 软引用
      UPROPERTY(Category = MyTest1, EditAnywhere) UTexture2D* SourceTexture2; // 硬引用
  };
  ```

  在Referece Viewer中，**粉色**的线为弱引用，白色的线为强引用：

  ![img](https://sin998-blog-image.oss-cn-beijing.aliyuncs.com/images/202111212236292.png)







